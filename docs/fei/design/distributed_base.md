# 分布式基础

## 分布式特点

* 容错

  发生故障时，如何让系统继续运行

* 高可用

  系统中断时，如何尽快恢复系统

* 灾备

  系统毁灭时，如何抢救数据

## 分布式ID，全局ID

`ID`是数据的唯一标识，通常使用`UUID`和数据库的自增`ID`

### 自增方案

1. 依赖单独的`MySql`实例生成唯一`ID`

    缺点：性能低，可靠性低

2. 依赖两个单独的`MySql`实例生成唯一`ID`，如`DB1`生成奇数，`DB2`生成偶数

    缺点：性能低，扩展性差

3. `DB`返回一个号段，而不是`ID`，如`[0,1000]`，把号段存在内存中再进行自增

    缺点：内存如果缺失了，就会造成`ID`空洞

### 雪花算法

根据时间戳 + 工作机器`ID` + 序列号生成唯一的`ID`

缺点：维护工作机器`ID`人工成本高

## 分布式事务

分布式事务本质上是对多个数据库的事务进行统一控制

按控制力度划分为

* 不控制

  不引进分布式事务

* 部分控制

  各种变种的两阶段提交，如信息事务 + 最终一致性、`TCC`模式

  性能好，数据一致性差，最终一致性

* 完成控制

  完全实现两阶段提交

  性能差，数据一致性好，强一致性
